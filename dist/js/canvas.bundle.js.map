{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/js/canvas.js"],"names":["HEADER_SIZE","REFRESH_RATE","MIN_FREQ","MAX_FREQ","FFT_SIZE","SMOOTHING","NUM_BINS","MIN_LOG","Math","log","MAX_LOG","LOG_RANGE","binSize","numBins","sampleRate","maxFreq","bucketRange","min","max","low","floor","high","range","logPosition","freq","minLog","logRange","width","canvas","document","querySelector","ctx","getContext","mouse","x","innerWidth","y","innerHeight","window","height","fillStyle","fillRect","actx","AudioContext","analyser","createAnalyser","fftSize","smoothingTimeConstant","navigator","mediaDevices","getUserMedia","audio","then","source","createMediaStreamSource","stream","connect","data","Uint8Array","frequencyBinCount","getByteFrequencyData","dataBuckets","addEventListener","event","clientX","clientY","state","resume","refTime","Date","now","elapsedTime","imageData","animate","requestAnimationFrame","getImageData","clearRect","putImageData","prevLogPos","i","rat","hue","round","sat","lit","beginPath","strokeStyle","moveTo","lineTo","stroke","closePath","topRow"],"mappings":"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","file":"./js/canvas.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/canvas.js\");\n","const HEADER_SIZE = 35\nconst REFRESH_RATE = 100\nconst MIN_FREQ = 80\nconst MAX_FREQ = 12000\nconst FFT_SIZE = 16384 // 32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768\nconst SMOOTHING = 0 // 0.0-1.0\nconst NUM_BINS = FFT_SIZE / 2\nconst MIN_LOG = Math.log(MIN_FREQ) / Math.log(10)\nconst MAX_LOG = Math.log(MAX_FREQ) / Math.log(10)\nconst LOG_RANGE = MAX_LOG - MIN_LOG\n\nfunction binSize(numBins, sampleRate) {\n  const maxFreq = sampleRate / 2\n  return maxFreq / numBins\n}\n\nfunction bucketRange(min, max, numBins, binSize) {\n  let low = Math.floor(min / binSize) - 1\n  low = low > 0 ? low : 0\n  const high = Math.floor(max / binSize) - 1\n  return {\n    low,\n    high,\n    range: high - low + 1,\n    binSize\n  }\n}\n\nfunction logPosition(freq, minLog, logRange, width) {\n  return ((Math.log(freq) / Math.log(10) - minLog) / logRange) * width\n}\n\nconst canvas = document.querySelector('canvas')\nconst ctx = canvas.getContext('2d')\n\nconst mouse = {\n  x: innerWidth / 2,\n  y: innerHeight / 2\n}\n\ncanvas.width = window.innerWidth\ncanvas.height = window.innerHeight - HEADER_SIZE\nctx.fillStyle = 'hsl(280, 100%, 10%)'\nctx.fillRect(0, 0, canvas.width, canvas.height)\n\n// Audio\nconst actx = new AudioContext()\nconst analyser = actx.createAnalyser()\nanalyser.fftSize = FFT_SIZE\nanalyser.smoothingTimeConstant = SMOOTHING\n\n//get mic input\nnavigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {\n  const source = actx.createMediaStreamSource(stream)\n  source.connect(analyser)\n})\nconst data = new Uint8Array(analyser.frequencyBinCount)\nanalyser.getByteFrequencyData(data)\nconst dataBuckets = bucketRange(\n  MIN_FREQ,\n  MAX_FREQ,\n  NUM_BINS,\n  binSize(NUM_BINS, actx.sampleRate)\n)\n\n// Event Listeners\ncanvas.addEventListener('mousemove', event => {\n  mouse.x = event.clientX\n  mouse.y = event.clientY\n})\n\nwindow.addEventListener('resize', () => {\n  canvas.width = innerWidth\n  canvas.height = innerHeight\n  ctx.fillStyle = 'hsl(280, 100%, 10%)'\n  ctx.fillRect(0, 0, canvas.width, canvas.height)\n})\n\ncanvas.addEventListener('click', event => {\n  // by default audio context will be suspended until user interaction.\n  if (actx.state === 'suspended') {\n    actx.resume()\n  }\n})\n\n// Animation Loop\nlet refTime = Date.now()\nlet elapsedTime = 0\nlet imageData\nfunction animate() {\n  // requestAnimationFrame callback aims for a 60 FPS callback rate but doesn’t guarantee it, so manual track elapsed time\n  requestAnimationFrame(animate)\n\n  // if (actx.state === 'suspended') {\n  //   ctx.clearRect(0, 0, canvas.width, canvas.height)\n  //   ctx.fillStyle = '#fff'\n  //   ctx.fillText('CLICK TO BEGIN', mouse.x, mouse.y)\n  // }\n\n  imageData = ctx.getImageData(0, 0, canvas.width, canvas.height - 1)\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\n  ctx.fillRect(0, 0, canvas.width, canvas.height)\n  ctx.putImageData(imageData, 0, 1)\n\n  elapsedTime = Date.now() - refTime\n\n  // slow down fft to only run every 200 ms\n  if (elapsedTime >= REFRESH_RATE) {\n    refTime = Date.now()\n\n    analyser.getByteFrequencyData(data)\n\n    let prevLogPos = 0\n    for (let i = dataBuckets.low; i <= dataBuckets.high; i++) {\n      // console.log(prevLogPos)\n      let rat = data[i] / 255\n      let hue = Math.round((rat * 120 + 280) % 360)\n      let sat = '100%'\n      let lit = 10 + 70 * rat\n      ctx.beginPath()\n      ctx.strokeStyle = `hsl(${hue}, ${sat}, ${lit}%)`\n      ctx.moveTo(prevLogPos, 0)\n      prevLogPos = logPosition(\n        i * dataBuckets.binSize,\n        MIN_LOG,\n        LOG_RANGE,\n        canvas.width\n      )\n      ctx.lineTo(prevLogPos, 0)\n      ctx.stroke()\n      ctx.closePath()\n    }\n\n    // // linear\n    // for (let i = dataBuckets.low; i <= dataBuckets.high; i++) {\n    //   let rat = data[i] / 255\n    //   let hue = Math.round((rat * 120 + 280) % 360)\n    //   let sat = '100%'\n    //   let lit = 10 + 70 * rat\n    //   ctx.beginPath()\n    //   ctx.strokeStyle = `hsl(${hue}, ${sat}, ${lit}%)`\n    //   ctx.moveTo((i * canvas.width) / dataBuckets.range, 0)\n    //   // ctx.moveTo(x, H - i * h)\n    //   ctx.lineTo(\n    //     canvas.width / dataBuckets.range +\n    //       (i * canvas.width) / dataBuckets.range,\n    //     0\n    //   )\n    //   // ctx.lineTo(x, H - (i * h + h))\n    //   ctx.stroke()\n    //   ctx.closePath()\n    // }\n  } else {\n    let topRow = (imageData = ctx.getImageData(0, 1, canvas.width, 2))\n    ctx.putImageData(imageData, 0, 0)\n  }\n}\n\nanimate()\n"],"sourceRoot":""}